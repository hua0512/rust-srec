<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 900">
  <defs>
    <!-- Modern Color Palette -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap');
      text { font-family: 'Inter', 'Segoe UI', sans-serif; }
      .label-title { font-weight: 600; font-size: 13px; fill: #f8fafc; }
      .label-sub { font-size: 9px; fill: #94a3b8; }
      .container-title { font-weight: 600; font-size: 11px; fill: #6366f1; letter-spacing: 0.1em; text-transform: uppercase; }
      
      /* Glassmorphism Classes */
      .glass-node { fill: rgba(30, 41, 59, 0.7); stroke-width: 1px; }
      .node-client { stroke: #10b981; }
      .node-api { stroke: #0ea5e9; }
      .node-runtime { stroke: #6366f1; }
      .node-exec { stroke: #f43f5e; }
      .node-storage { stroke: #f59e0b; }
      
      .flow-path { fill: none; stroke: rgba(148, 163, 184, 0.2); stroke-width: 1.5; }
      .flow-path-accent { stroke: rgba(99, 102, 241, 0.4); }
    </style>

    <!-- Filters -->
    <filter id="glass-blur" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feComposite in="SourceGraphic" in2="blur" operator="over"/>
    </filter>

    <filter id="soft-glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="glow"/>
      <feMerge>
        <feMergeNode in="glow"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <marker id="dot" markerWidth="4" markerHeight="4" refX="2" refY="2" markerUnits="strokeWidth">
      <circle cx="2" cy="2" r="1.5" fill="rgba(148, 163, 184, 0.5)" />
    </marker>

    <marker id="arrow-mini" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M1,1 L7,4 L1,7" fill="none" stroke="rgba(148, 163, 184, 0.5)" stroke-width="1" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1000" height="900" fill="#020617" />
  
  <!-- Subtle Grid -->
  <g opacity="0.05">
    <path d="M 50 0 V 900 M 150 0 V 900 M 250 0 V 900 M 350 0 V 900 M 450 0 V 900 M 550 0 V 900 M 650 0 V 900 M 750 0 V 900 M 850 0 V 900 M 950 0 V 900" stroke="#94a3b8" />
    <path d="M 0 50 H 1000 M 0 150 H 1000 M 0 250 H 1000 M 0 350 H 1000 M 0 450 H 1000 M 0 550 H 1000 M 0 650 H 1000 M 0 750 H 1000 M 0 850 H 1000" stroke="#94a3b8" />
  </g>

  <!-- 1. Client & API Layer -->
  <g transform="translate(500, 80)">
    <!-- Client -->
    <rect x="-80" y="-30" width="160" height="60" rx="4" class="glass-node node-client" filter="url(#glass-blur)" />
    <text y="-2" text-anchor="middle" class="label-title">Client</text>
    <text y="12" text-anchor="middle" class="label-sub">Web UI / API Clients</text>
    
    <!-- Flow -->
    <path d="M0 30 V 70" class="flow-path" marker-end="url(#arrow-mini)" />

    <!-- API Layer -->
    <g transform="translate(0, 100)">
      <rect x="-80" y="-30" width="160" height="60" rx="4" class="glass-node node-api" filter="url(#glass-blur)" />
      <text y="-2" text-anchor="middle" class="label-title">API Layer</text>
      <text y="12" text-anchor="middle" class="label-sub">Axum / JWT / OpenAPI</text>
    </g>
  </g>

  <!-- 2. Runtime Container -->
  <g transform="translate(50, 260)">
    <rect width="900" height="420" rx="8" fill="none" stroke="#6366f1" stroke-width="0.5" stroke-dasharray="8 8" opacity="0.3" />
    <text x="450" y="-15" text-anchor="middle" class="container-title">Runtime Service Container</text>

    <!-- Services Row 1 -->
    <g transform="translate(130, 70)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-runtime" filter="url(#glass-blur)" />
      <text y="-1" text-anchor="middle" class="label-title">Config Svc</text>
      <text y="11" text-anchor="middle" class="label-sub">Hot Reload / Merge</text>
    </g>

    <g transform="translate(340, 70)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-runtime" filter="url(#glass-blur)" />
      <text y="-1" text-anchor="middle" class="label-title">Streamer Mgr</text>
      <text y="11" text-anchor="middle" class="label-sub">State Sync</text>
    </g>

    <g transform="translate(550, 70)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-runtime" filter="url(#glass-blur)" />
      <text y="5" text-anchor="middle" class="label-title">Scheduler</text>
    </g>

    <g transform="translate(760, 70)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-runtime" filter="url(#glass-blur)" />
      <text y="-1" text-anchor="middle" class="label-title">Monitor</text>
      <text y="11" text-anchor="middle" class="label-sub">Status / Outbox</text>
    </g>

    <!-- Flow: Scheduler -> Monitor -->
    <path d="M615 70 H 695" class="flow-path" marker-end="url(#arrow-mini)" />

    <!-- Services Row 2 -->
    <g transform="translate(300, 200)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-runtime" filter="url(#glass-blur)" />
      <text y="5" text-anchor="middle" class="label-title">Danmu Svc</text>
    </g>

    <g transform="translate(500, 200)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-runtime" filter="url(#glass-blur)" />
      <text y="-1" text-anchor="middle" class="label-title">Download Mgr</text>
      <text y="11" text-anchor="middle" class="label-sub">Engine Control</text>
    </g>

    <g transform="translate(700, 200)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-runtime" filter="url(#glass-blur)" />
      <text y="-1" text-anchor="middle" class="label-title">Pipeline Mgr</text>
      <text y="11" text-anchor="middle" class="label-sub">DAG / Jobs</text>
    </g>

    <!-- Flow: Monitor -> Middle -->
    <path d="M760 95 V 140 H 400 V 175" class="flow-path" marker-end="url(#arrow-mini)" />
    <path d="M760 95 V 140 H 600 V 175" class="flow-path" marker-end="url(#arrow-mini)" />

    <!-- Flow: Danmu/Download -> Pipeline -->
    <path d="M365 200 H 435" class="flow-path" marker-end="url(#arrow-mini)" />
    <path d="M565 200 H 635" class="flow-path" marker-end="url(#arrow-mini)" />

    <!-- Notification Svc -->
    <g transform="translate(500, 330)">
      <rect x="-75" y="-20" width="150" height="40" rx="4" class="glass-node node-runtime" filter="url(#glass-blur)" />
      <text y="5" text-anchor="middle" class="label-title">Notification Svc</text>
    </g>
    
    <!-- Flow: Pipeline -> Notification -->
    <path d="M700 225 V 285 H 575" class="flow-path" marker-end="url(#arrow-mini)" opacity="0.5" stroke-dasharray="4 4" />
  </g>

  <!-- 3. Execution & Persistence -->
  <g transform="translate(0, 740)">
    <!-- Engines -->
    <g transform="translate(420, 0)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-exec" filter="url(#glass-blur)" />
      <text y="-1" text-anchor="middle" class="label-title">Engines</text>
      <text y="11" text-anchor="middle" class="label-sub">FFmpeg / Mesio</text>
    </g>

    <!-- Workers -->
    <g transform="translate(750, 0)">
      <rect x="-65" y="-25" width="130" height="50" rx="4" class="glass-node node-exec" filter="url(#glass-blur)" />
      <text y="-1" text-anchor="middle" class="label-title">Workers</text>
      <text y="11" text-anchor="middle" class="label-sub">CPU / IO Pools</text>
    </g>

    <!-- Persistence -->
    <g transform="translate(500, 110)">
      <rect x="-420" y="-20" width="840" height="40" rx="4" class="glass-node node-storage" filter="url(#glass-blur)" />
      <text y="5" text-anchor="middle" class="label-title" style="letter-spacing: 0.2em; fill: #fbbf24; font-size: 11px;">PERSISTENCE: SQLITE | FILESYSTEM | CACHE</text>
    </g>

    <!-- Flows -->
    <path d="M550 -80 V 40 H 485" class="flow-path" marker-end="url(#arrow-mini)" />
    <path d="M750 -80 V -25" class="flow-path" marker-end="url(#arrow-mini)" />
  </g>

  <!-- Flow Animations (Subtle Pulses) -->
  <circle r="2" fill="#0ea5e9" filter="url(#soft-glow)">
    <animateMotion dur="4s" repeatCount="indefinite" path="M500 110 V 150" />
  </circle>
  
  <circle r="1.5" fill="#6366f1" filter="url(#soft-glow)">
    <animateMotion dur="5s" repeatCount="indefinite" path="M600 330 H 680 V 375" />
  </circle>

</svg>
