[package]
name = "platforms-parser"
version = "0.1.10"
edition = "2024"
description = "A library for extracting streaming data from various online platforms."
repository = "https://github.com/hua0512/rust-srec"
license = "MIT OR Apache-2.0"
keywords = ["streaming", "extractor", "downloader"]
categories = ["multimedia::streaming", "api-bindings"]

[dependencies]
bytes = { workspace = true }
tokio = { workspace = true, features = [
    "rt",
    "io-util",
    "macros",
    "fs",
    "process",
] }
reqwest = { workspace = true, features = [
    "json",
    "stream",
    "gzip",
    "deflate",
] }
rustls = { workspace = true }
rustls-platform-verifier = { workspace = true }
url = { workspace = true }
thiserror = { workspace = true }
libsm = { workspace = true }

serde = { workspace = true, features = ["derive", "rc"] }
serde_json = { workspace = true }

regex = { workspace = true, default-features = false, features = [
    "std",
    "unicode-perl",
] }
 
 # Logging
tracing = { workspace = true }
tracing-subscriber = { workspace = true }
async-trait = { workspace = true }
tars-codec = { path = "../tars-codec"}
rustc-hash = { workspace = true }
rand = { workspace = true }

# RSA for Bilibili cookie refresh
rsa = { workspace = true, features = ["sha2"] }
sha2 = { workspace = true }
hex = { workspace = true }

# JavaScript engine
rquickjs = { version = "0.11.0", optional = true, features = ["full-async"] }

uuid  = { workspace = true, features = ["v4"]}
m3u8-rs = { workspace = true }
md-5 = { workspace = true }
urlencoding = { workspace = true }
base64 = { workspace = true }
tokio-tungstenite = { workspace = true, default-features = false, features = ["connect"] }
chrono = { workspace = true, features = ["serde"] }
futures = { workspace = true }
# tokio-rustls = { version = "0.26", default-features = false, features = ["aws-lc-rs", "logging", "tls12"] }
# webpki-roots = "0.26"
flate2 = { workspace = true }
parking_lot = { workspace = true }
byteorder = { workspace = true }
brotli = { workspace = true }
openssl = { workspace = true, optional = true, features = ["vendored"] }
native-tls = { workspace = true, optional = true }
process-utils = { path = "../process-utils" }

# Protocol Buffers
prost = { workspace = true }
prost-types = { workspace = true }

[build-dependencies]
prost-build = { workspace = true }


[features]
default = ["rustls-tls"]
rquickjs = ["dep:rquickjs"]
static-ssl = ["openssl", "tls-native-fallback", "native-tls/vendored"]
# TLS backend for WebSocket connections (tokio-tungstenite)
# native-tls: Uses platform native TLS (SChannel on Windows, Security.framework on macOS, OpenSSL on Linux)
# rustls-tls: Uses rustls (pure Rust, works everywhere without system dependencies)
native-tls = ["dep:native-tls", "tokio-tungstenite/native-tls"]
rustls-tls = ["tokio-tungstenite/rustls-tls-native-roots"]

# Enable both backends so we can pick per-host at runtime.
tls-native-fallback = ["native-tls", "rustls-tls"]
